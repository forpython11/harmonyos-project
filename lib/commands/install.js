"use strict";var t=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function l(t){try{a(i.next(t))}catch(t){o(t)}}function r(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(l,r)}a((i=i.apply(t,e||[])).next())}))},e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.installCmd=void 0;const n=require("../core/install"),i=require("../common/message"),s=e(require("../log")),o=require("../core/audit"),l=require("../util"),r=require("../core/scripts/ScriptRunner"),a=require("../common/GlobalState");function u(e){return t(this,void 0,void 0,(function*(){if(!e.installCost||0!==e.installCost.totalCost)try{yield(0,o.auditRequest)(e)}catch(t){s.default.debug("","")}}))}exports.installCmd=function(e,s){return t(this,void 0,void 0,(function*(){a.GlobalState.command=a.CommandType.INSTALL;let t={};try{t=(0,o.commandAudit)("install"),r.ScriptRunner.runHook(r.ScriptConstants.preInstall),yield(0,n.installSymlink)(e,s),r.ScriptRunner.runHook(r.ScriptConstants.postInstall),t=Object.assign(Object.assign(Object.assign({},t),(0,o.installResultAudit)(!0)),(0,o.installCostAudit)(o.InstallInfo.cost,o.InstallInfo.packageNum)),yield u(t)}catch(e){l.PrintUtil.print((0,i.getMessage)("install.fail")),t=Object.assign(Object.assign({},t),(0,o.installResultAudit)(!1)),yield u(t),process.exit(1)}}))};