"use strict";var e=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,o){function a(e){try{r(n.next(e))}catch(e){o(e)}}function c(e){try{r(n.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,c)}r((n=n.apply(e,t||[])).next())}))},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractPackage=void 0;const i=require("../service/common"),n=require("../../../util"),s=t(require("path")),o=require("./LocalDirPackage"),a=require("../../../common/Constants"),c=t(require("../../../log"));exports.AbstractPackage=class{constructor(e,t,i){this.children=[],this.saveRootDir="",this.pkgStoreDir="",this.cachePath="",this.name=e,this.fetchSpec=t,this.saveSpec=i}fetch(t){return e(this,void 0,void 0,(function*(){c.default.debug("fetching package",`${this.name}@${this.fetchSpec}`)}))}symlink(t,c){return e(this,void 0,void 0,(function*(){(0,i.deleteExtraneousLinks)(c,(e=>e===this.name||-1!==this.children.findIndex((t=>t.name===e)))),this.children.length>0&&n.FsUtil.createDirIfNotExists(c);for(const e of this.children){const t=s.default.join(c,e.name);if(e instanceof o.LocalDirPackage&&e.isLink)yield n.FsUtil.symLinkDir(e.fetchSpec,t);else{const o=s.default.join(e.saveRootDir,a.Constants.MyModules,e.name);(0,i.checkFileIfExist)(o),yield n.FsUtil.symLinkDir(o,t)}}}))}ensureOhPackageJson5(e){const t=s.default.join(e,a.Constants.PackageJson),i=s.default.join(e,a.Constants.MyPackageJson),o=n.FsUtil.existsSync(t);if(n.FsUtil.existsSync(i))o&&n.FsUtil.rmSync(t);else{if(!o)throw c.default.error("",`Could not find a file named "${a.Constants.MyPackageJson}" in "${e}" not found.`),"";n.FsUtil.renameSync(t,i)}}};