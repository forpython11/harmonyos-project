"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PackageLock=void 0;const s=require("../../util"),i=e(require("path")),t=require("../../common/Constants"),c=e(require("semver"));var n;!function(e){e[e.version=1]="version"}(n||(n={}));const o={lockfileVersion:n.version,ATTENTION:"THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.",specifiers:{},packages:{}},r=new Set,a=new Set;let f=o,l=i.default.join(process.cwd(),t.Constants.LockJson),d=!1;function p(e,s){const i=`${e}@${s}`;r.add(i);const t=f.specifiers;if(t)return!t[i]&&c.default.valid(s)?i:t[i]}exports.PackageLock={initLockJson:function(e){if(!d){if(l=i.default.join(e,t.Constants.LockJson),s.FsUtil.existsSync(l)){const e=s.FsUtil.readJSON5Sync(l);n.version===e.lockfileVersion&&(f=e,f.lockfileVersion=o.lockfileVersion,f.ATTENTION=o.ATTENTION)}d=!0}},updateLockFile:function(){Object.keys(f.specifiers).forEach((e=>{if(!r.has(e))return void delete f.specifiers[e];const s=f.specifiers[e];a.add(s)})),Object.keys(f.packages).forEach((e=>{if(!a.has(e))return void delete f.packages[e];const s=f.packages[e];s.dependencies&&0!==Object.keys(s.dependencies).length||(s.dependencies=void 0)})),(s.FsUtil.existsSync(l)||Object.keys(f.packages).length>0)&&s.FsUtil.writeFileSync(l,JSON.stringify(f,null,2))},getLockSpec:p,updateLockSpec:function(e,s,i){const t=`${e}@${s}`,c=f.specifiers;r.add(t),c[t]=`${e}@${i}`},deleteSpec:e=>delete f.specifiers[e],clearSpecifiers:()=>f.specifiers={},getLockPkg:function(e,s){const i=p(e,s),t=f.packages;if(i&&t)return t[i]},updateLockPkg:function(e,s,i){f.packages[`${e}@${s}`]=i}};