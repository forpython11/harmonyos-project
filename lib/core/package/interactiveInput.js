"use strict";var t=this&&this.__awaiter||function(t,n,e,i){return new(e||(e=Promise))((function(s,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var n;t.done?s(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,r)}c((i=i.apply(t,n||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});const n=require("./util"),e=require("../../util"),i=require("../../common/Constants"),s=require("prompt");function o(e){return t(this,void 0,void 0,(function*(){yield s.get([{name:"name",description:"package name",type:"string",default:e,required:!0}],(function(t,i){const s=(0,n.validateNameFun)(i.name,"init");s?a({name:s}):o(e)}))}))}function a(e){return t(this,void 0,void 0,(function*(){yield s.get([{name:"version",description:"version",type:"string",default:"1.0.0",required:!0}],(function(t,i){const s=(0,n.validateVersionFun)(i.version);s?r(Object.assign(Object.assign({},e),{version:s})):a(e)}))}))}function r(e){return t(this,void 0,void 0,(function*(){yield s.get([{name:"description",description:"description",type:"string"}],(function(i,o){const a=o.description;a.length<30||a.length>512?((0,n.output)("The description contains more than 30 characters and less than 512 characters."),r(e)):function(n){t(this,void 0,void 0,(function*(){yield s.get([{name:"main",description:"entry point",default:"index.ets",type:"string",required:!0}],(function(t,e){const i=e.main;c(Object.assign(Object.assign({},n),{main:i}))}))}))}(Object.assign(Object.assign({},e),{description:a}))}))}))}function c(e){return t(this,void 0,void 0,(function*(){yield s.get([{name:"author",description:"author",type:"string"}],(function(t,i){let s,o=i.author.trim();s=!o||(o.toLowerCase().includes("name:")||o.toLowerCase().includes("email:")?(0,n.validateAuthorFun)(o):(0,n.validateAuthorStringFun)(o)),s?(o=!0===s?"":s,u(Object.assign(Object.assign({},e),{author:o}))):c(e)}))}))}function u(o){return t(this,void 0,void 0,(function*(){yield s.get([{name:"license",description:"license",default:"ISC",type:"string",required:!0}],(function(a,r){const c=(0,n.validateLicenseFun)(r.license);if(c.type){const a=JSON.stringify(Object.assign(Object.assign({},o),{license:c.license,dependencies:{}}),null," ");(0,n.output)(`About to write to ${process.cwd()}\\${i.Constants.MyPackageJson}:\n`),(0,n.output)(`${a}\n\n`),function(n){t(this,void 0,void 0,(function*(){yield s.get([{name:"ok",description:"Is this OK?",default:"yes",type:"string",required:!0}],(function(t,s){"yes"!==s.ok.toLowerCase()&&"y"!==s.ok.toLowerCase()||e.FsUtil.writeFileSync(`${i.Constants.MyPackageJson}`,n)}))}))}(a)}else u(o)}))}))}s.message="",s.start(),s.colors=!1,exports.default=function(e){return t(this,void 0,void 0,(function*(){(0,n.output)(`This utility will walk you through creating a ${i.Constants.MyPackageJson} file.\nIt only covers the most common items, and tries to guess sensible defaults.\n\nSee ${i.Constants.PM} help init for definitive documentation on these fields\nand exactly what they do.\n\nUse ${i.Constants.PM} install <pkg> afterwards to install a package and\nsave it as a dependency in the ${i.Constants.MyPackageJson} file.\n\nPress ^C at any time to quit.`),yield o(e)}))};