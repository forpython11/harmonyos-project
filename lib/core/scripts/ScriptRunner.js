"use strict";var t=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(e,r);o&&!("get"in o?!e.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,o)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),e=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var n={};if(null!=r)for(var o in r)"default"!==o&&Object.prototype.hasOwnProperty.call(r,o)&&t(n,r,o);return e(n,r),n},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ScriptRunner=exports.hookMap=exports.ScriptConstants=void 0;const o=require("child_process"),s=n(require("../../log")),i=n(require("path")),a=require("../../common/Constants"),l=require("../../util"),p=r(require("process")),c=require("../../common/GlobalState"),u="win32"===p.platform,d=u?p.env.ComSpec||"cmd":p.env.SHELL||"sh";exports.ScriptConstants={preInstall:"preInstall",postInstall:"postInstall",preUninstall:"preUninstall",postUninstall:"postUninstall"},exports.hookMap={[exports.ScriptConstants.preInstall]:c.CommandType.INSTALL,[exports.ScriptConstants.postInstall]:c.CommandType.INSTALL,[exports.ScriptConstants.preUninstall]:c.CommandType.UNINSTALL,[exports.ScriptConstants.postUninstall]:c.CommandType.UNINSTALL};exports.ScriptRunner=class{static runHook(t,e=p.cwd(),r){c.GlobalState.command&&exports.hookMap[t]&&c.GlobalState.command===exports.hookMap[t]&&this.runScript("hooks",t,e,r)}static runScript(t,e,r,n){let o=n;o||(o=this.getPkgJson(r)),o&&o[t]&&o[t][e]&&this.run(e,o[t][e],r)}static getPkgJson(t){const e=i.default.join(t,a.Constants.MyPackageJson);if(l.FsUtil.existsSync(e))try{return l.FsUtil.readJSON5Sync(e)}catch(t){s.default.error("JSON5.parse",`Failed to parse ${e}`)}}static run(t,e,r=p.cwd()){var n;if(!e)return void s.default.error("",`Missing script: ${t}`);(0,l.output)(`\n> ${t} ${r}`),(0,l.output)(`> ${e}\n`);const i=u?["/d","/s","/c",e]:["-c","--",e],a=(0,o.spawnSync)(d,i,{windowsVerbatimArguments:!0,stdio:"inherit",cwd:r,env:p.env});if(!a||0!==a.status){const e=null===(n=a.error)||void 0===n?void 0:n.message;s.default.error(`Failed to execute the script: ${t}`,e||""),s.default.error("path",r),s.default.error("command",i.join(" ")),p.exit(1)}}};